<!doctype html>
<html>

<head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <title>登录</title>
    <link rel="stylesheet" href="iconfont/iconfont.css">
    <style>
        * {
            margin: 0px;
            padding: 0px;
            list-style: none;
            box-sizing: border-box;
        }

        [v-cloak] {
            display: none;
        }

        body {
        }

        :root {
            --green: #00D3C4;
            --greenLight: #63ff00;
            --yellow: #fa0;
            --line: #dedede;
            --gray: #888;
            --white: #fff;

        }

        body {
            font-size: 14px;
            font-family: '宋体';
        }

        .myapp {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 15px;
        }

        .myapp h1 {
            font-weight: normal;
            font-size: clamp(26px, 3vw, 40px);
            padding: 30px 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px
        }

        .myapp .ht {
            display: flex;
            align-items: stretch;
            margin-bottom: 15px;
            height: 42px;
            width: 100%;
            max-width: 300px;
        }

        .myapp .ht .ti {
            background: var(--green);
            width: 80px;
            color: var(--white);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .myapp .ht .ip {
            border: solid 1px var(--line);
            width: calc(100% - 80px);
        }

        .myapp .ht .ip input {
            width: 100%;
            height: 100%;
            border: none;
            outline: none;
            padding: 0 15px;
        }


        .myapp .btn {
            background: var(--yellow);
            padding: 15px 30px;
            color: var(--white);
            cursor: pointer;
        }


    </style>
</head>

<body>
<div class="myapp">
    <h1>登录</h1>
    <div class="ht">
        <div class="ti">邮箱</div>
        <div class="ip"><input type="text" v-model="email"></div>
    </div>
    <div class="ht">
        <div class="ti">密码</div>
        <div class="ip"><input type="password" v-model="password"></div>
    </div>
    <div class="btn" @click="login">登录</div>

</div>
<script src="index.js"></script>
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>
<script>
    new Vue({
        el: '.myapp',
        data: {
            base: null,
            email:'',
            password:''
        },
        mounted() {
            this.getBase()
            this.checkLogin()
        },
        methods: {
            async login() {
                 const {data}=await this.base.auth.signInWithPassword({
                    email: this.email,
                    password: this.password,
                })
                console.log(data)
                if(data.user!=null){
                    location.href='money.html'
                }else{
                    //alert("错误")
                }
            },
            async getBase() {
                const {createClient} = supabase
                this.base = createClient('https://pmfxqcqvqrhxnxyotyzp.supabase.co', 'sb_publishable_T98PsjOazNXjyak2nXPwDg_ox52NaWg')
            },
            async checkLogin() {

                // await this.base.auth.onAuthStateChange((event, session) => {
                //     if (event === 'SIGNED_IN') console.log('SIGNED_IN', session)
                // })

                const {data} = await this.base.auth.getUser()
                if(data.user!=null){
                    location.href='money.html'
                }

            },
        },
        computed: {},
    })
</script>
</body>

</html>
